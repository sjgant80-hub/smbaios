<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SMB AI OS</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #f5f4f0; }
    #root { min-height: 100vh; }
    #loading {
      display: flex; align-items: center; justify-content: center;
      height: 100vh; font-family: 'DM Sans', sans-serif;
      color: #6a6560; font-size: 0.9rem; letter-spacing: 0.05em;
    }
  </style>
</head>
<body>
  <div id="root"><div id="loading">Loading SMB AI OS...</div></div>

  <!-- window.storage polyfill — uses localStorage in non-artifact environments -->
  <script>
    window.storage = {
      get: async function(key) {
        var v = localStorage.getItem('smbaios__' + key);
        return v !== null ? { value: v } : null;
      },
      set: async function(key, value) {
        localStorage.setItem('smbaios__' + key, value);
      },
      delete: async function(key) {
        localStorage.removeItem('smbaios__' + key);
      }
    };
  </script>

  <!-- React 18 + ReactDOM (UMD globals) -->
  <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>

  <!-- Babel standalone for JSX transpilation -->
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>

  <script>
    (async function () {
      try {
        var response = await fetch('./smb_ai_os.jsx');
        if (!response.ok) throw new Error('HTTP ' + response.status + ' fetching smb_ai_os.jsx');
        var jsx = await response.text();

        // Replace ES module import with destructured globals (React is on window)
        var code = jsx.replace(
          /import\s+\{([^}]+)\}\s+from\s+['"]react['"];?\s*\n?/,
          function(_, imports) {
            var vars = imports.split(',').map(function(s) { return s.trim(); }).join(', ');
            return 'var { ' + vars + ' } = React;\n';
          }
        );

        // Strip "export default" so App lands in scope
        code = code.replace(/^export\s+default\s+(function\s+App)/m, '$1');

        // Transpile JSX → JS
        var result = Babel.transform(code, { presets: ['react'], filename: 'smb_ai_os.jsx' });

        // Execute: App will be defined in scope; we return it
        var fn = new Function('React', 'ReactDOM', result.code + '\nreturn typeof App !== "undefined" ? App : null;');
        var App = fn(React, ReactDOM);

        if (!App) throw new Error('App component not found after transpilation');

        // Mount
        var root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));

      } catch (err) {
        console.error('[SMB AI OS]', err);
        document.getElementById('root').innerHTML =
          '<div style="padding:48px 32px;font-family:sans-serif;max-width:500px;margin:0 auto">' +
          '<h2 style="color:#c8150a;margin-bottom:12px">Failed to load SMB AI OS</h2>' +
          '<p style="color:#444;line-height:1.6;margin-bottom:16px">' + err.message + '</p>' +
          '<p style="color:#888;font-size:0.85rem;line-height:1.6">' +
          'Make sure you\'re serving these files from a web server (not file://).<br>' +
          'Try: <code>npx serve .</code> in this folder.' +
          '</p></div>';
      }
    })();
  </script>
</body>
</html>
